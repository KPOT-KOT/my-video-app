<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title><%= filename %></title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: #eee;
            margin: 0;
            padding: 20px;
        }
        a.back {
            color: #4ea3ff;
            font-size: 18px;
            text-decoration: none;
            margin-bottom: 15px;
            display: inline-block;
        }
        h2 {
            margin-top: 10px;
            margin-bottom: 20px;
        }
        video {
            width: 100%;
            max-height: 90vh;
            background: black;
        }
    </style>
</head>
<body>

    <!-- Back to folder -->
    <a class="back" href="/?dir=<%= parentDirEncoded %>">⬅ Back to Folder</a>

    <!-- Title -->
    <h2 id="videoTitle"><%= filename %></h2>

    <!-- Video Player -->
    <video id="videoPlayer" controls autoplay>
        <source src="/video-stream?path=<%= encodedPath %>" type="video/mp4">
    </video>

    <script>
        const video = document.getElementById("videoPlayer");
        const source = video.querySelector("source");

        // playlist: [{ encoded, name }, ...]
        const playlist = <%- JSON.stringify(playlist) %>;
        let index = <%= index %>;

        function playNext() {
            index++;

            if (index >= playlist.length) {
                index = 0;
            }

            const next = playlist[index];

            // Update video source
            source.src = "/video-stream?path=" + next.encoded;
            video.load();
            video.play().catch(() => {});

            // Update title text
            const title = document.getElementById("videoTitle");
            if (title) {
                title.textContent = next.name;
            }

            // Update URL so Back to Folder / history still make sense
            window.history.replaceState(null, "", "/player?path=" + next.encoded);
        }

        // When video ends → play next
        video.addEventListener("ended", playNext);
    </script>

</body>
</html>
